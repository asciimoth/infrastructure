Installtion instruction

0) Boot from installation usb
1) Install some tools
  $ nix-shell -p fido2luks git yubikey-manager openssl expect micro
2) Clone this repo
  $ git clone https://github.com/asciimoth/infrastructure.git
  $ chmod +x infrastructure/*.sh
2) wipe disk if neded
  $ sudo wipefs -a /dev/<disk ex sda>
4)  [If not already created] Create new partition table
  $ sudo fdisk /dev/<disk ex sda>
    g
    w
5) [If not already created] Create boot (UEFI) partition and format it 
  $ sudo fdisk /dev/<disk ex sda>
    n
    enter
    enter
    +2G
    t
    EFI System
    w
  $ sudo mkfs.fat -F 32 /dev/<boot partition name ex sda1>
6) Create partition for LUKS
  $ sudo fdisk /dev/<disk ex sda>
    n
    enter
    enter
    enter
    w
7) Generate temporal password
  $ export PASSWORD=$(openssl rand 128 | nase64 -w0)
8) Setup luks partition encrypted with password
  $ echo "$PASSWORD" | sudo cryptsetup luksFormat -q /dev/<partition ex sda2>
  $ echo "$PASSWORD" | sudo cryptsetup luksOpen --test-passphrase /dev/<partition ex sda2>
9) Setup fido2luks
  chose a hostname for instalation system
  export NEWHOSTNAME="pcLexell"
  repeat for every token:
    $ sudo fido2luks.sh /dev/sda2 $NEWHOSTNAME ~/creds $PASSWORD <token fido pin> <new password>
10) Mount creted luks partition
  $ echo "$PASSWORD" | sudo cryptsetup luksOpen /dev/<partition ex sda2> crypted -
11) Set up fs
  $ sudo mkfs.ext4 /dev/mapper/crypted
12) Mount root
  $ sudo mount /dev/mapper/crypted /mnt
13) Mount UEFI/boot partition
  $ sudo mount /dev/<UEFI partition ex sda1> /mnt/boot
14) Generate system config
  $ sudo nixos-generate-config --root /mnt
15) Copy config
  $ cp -r infrastructure /mnt/etc/infrastructure
16) Copy new configuration.nix and hardware-configuration.nix to config
  $ cp /mnt/etc/nixos/*configuration.nix /mnt/etc/infrastructure/machines/pcLexell/
17) Patch generated config
  # There should not be nothing luks with password
  # There should be this params
  boot.initrd.luks.fido2Support = true;
  boot.initrd.luks.devices."/dev/sda2".fido2.credentials = [ "" "" ]; # Here should be credentails from ~/creds
18) Enable systemd-boot
  boot.loader.systemd-boot.enable = true;
  boot.loader.efi.canTouchEfiVariables = true;
19) Install from config
  $ sudo nixos-install --root /mnt --flake /mnt/etc/mynixos#pcLexell
20) Rip luks sliot with password
  $ echo "$PASSWORD" | sudo cryptsetup luksRemoveKey /dev/sdb1 -
21) Shutdown system
  $ shutdown now
22) Change booting queue in bios
23) Load to new sytem
